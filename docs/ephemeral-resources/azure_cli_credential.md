---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "azidentity_azure_cli_credential Ephemeral Resource - azidentity"
subcategory: ""
description: |-
  The azidentity_azure_cli_credential resource provides authentication using an active Azure CLI session. This allows Terraform to acquire tokens from the CLI without requiring stored credentials.
---

# azidentity_azure_cli_credential (Ephemeral Resource)

The `azidentity_azure_cli_credential` resource provides authentication using an active **Azure CLI session**. This allows Terraform to acquire tokens from the CLI without requiring stored credentials.


## Example Usage

```terraform
terraform {
  required_version = ">= 1.10.0"
  required_providers {
    azidentity = {
      source = "co-native-ab/azidentity"
    }
  }
}

provider "azidentity" {}

ephemeral "azidentity_azure_cli_credential" "this" {
  scopes = ["https://management.azure.com/.default"]
}
```

## Grafana Provider Example

This is an example to show how to use the `azidentity_azure_cli_credential` ephemeral resource with the [grafana terraform provider](https://registry.terraform.io/providers/grafana/grafana/latest/docs) and [Azure Managed Grafana](https://learn.microsoft.com/en-us/azure/managed-grafana).

```terraform
terraform {
  required_version = ">= 1.10.0"
  required_providers {
    azurerm = {
      source = "hashicorp/azurerm"
    }
    azapi = {
      source = "Azure/azapi"
    }
    azidentity = {
      source = "co-native-ab/azidentity"
    }
    grafana = {
      source = "grafana/grafana"
    }
  }
}

provider "azidentity" {}

ephemeral "azidentity_azure_cli_account" "this" {}

provider "azurerm" {
  features {}
  subscription_id = ephemeral.azidentity_azure_cli_account.this.subscription_id
}

provider "azapi" {
  subscription_id = ephemeral.azidentity_azure_cli_account.this.subscription_id
}

resource "azurerm_resource_group" "this" {
  name     = "rg-lab-sc-grafana"
  location = "Sweden Central"
}

resource "azapi_resource" "grafana" {
  type                      = "Microsoft.Dashboard/grafana@2024-10-01"
  name                      = "grf-lab-sc-grafana"
  location                  = azurerm_resource_group.this.location
  parent_id                 = azurerm_resource_group.this.id
  schema_validation_enabled = false

  body = {
    sku = {
      name = "Essential"
    }
    properties = {
      apiKey                  = "Disabled"
      deterministicOutboundIP = "Disabled"
      grafanaConfigurations = {
        security = {
          csrfAlwaysCheck = true
        }
        smtp = {
          enabled = false
        }
        snapshots = {
          externalEnabled = false
        }
        users = {
          viewersCanEdit = false
        }
      }
      grafanaMajorVersion = "10"
      publicNetworkAccess = "Enabled"
      zoneRedundancy      = "Disabled" # Not supported in Sweden Central yet
    }
  }

  response_export_values = ["properties.endpoint"]
}

data "azurerm_client_config" "current" {}

resource "azurerm_role_assignment" "current_grafana_admin" {
  scope                = azapi_resource.grafana.id
  role_definition_name = "Grafana Admin"
  principal_id         = data.azurerm_client_config.current.object_id
}

ephemeral "azidentity_azure_cli_credential" "grafana" {
  depends_on = [azurerm_role_assignment.current_grafana_admin]
  scopes     = ["ce34e7e5-485f-4d76-964f-b3d2b16d1e4f/.default"] # Microsofts Grafana Application ID
}

provider "grafana" {
  url  = azapi_resource.grafana.output.properties.endpoint
  auth = ephemeral.azidentity_azure_cli_credential.grafana.access_token
}

data "grafana_organization_preferences" "this" {
  depends_on = [azurerm_role_assignment.current_grafana_admin]
  org_id     = "1"
}

data "grafana_data_source" "azure_monitor" {
  depends_on = [azurerm_role_assignment.current_grafana_admin]
  name       = "Azure Monitor"
}

output "grafana" {
  value = {
    organization_preferences  = data.grafana_organization_preferences.this
    azure_monitor_data_source = data.grafana_data_source.azure_monitor
  }
}
```

*NOTE: Even though we are using the `azidentity_azure_cli_credential` ephemeral resource, it should work with any of the other credentials available in this provider.*

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `scopes` (Set of String) Scopes contains the list of permission scopes required for the token. E.g. https://management.azure.com/.default for Azure Resource Manager or https://graph.microsoft.com/.default for Microsoft Graph.

### Optional

- `additionally_allowed_tenants` (Set of String) AdditionallyAllowedTenants specifies tenants to which the credential may authenticate, in addition to TenantID. When TenantID is empty, this option has no effect and the credential will authenticate to any requested tenant. Add the wildcard value '*' to allow the credential to authenticate to any tenant. This value can also be set as a semicolon delimited list of tenants in the environment variable AZURE_ADDITIONALLY_ALLOWED_TENANTS. The default is an empty list.
- `claims` (String) Claims are any additional claims required for the token to satisfy a conditional access policy, such as a service may return in a claims challenge following an authorization failure. If a service returned the claims value base64 encoded, it must be decoded before setting this field. The default is an empty string.
- `continue_on_error` (Boolean) ContinueOnError indicates whether to continue on error when acquiring a token. The default is false.
- `enable_cae` (Boolean) EnableCAE indicates whether to enable Continuous Access Evaluation (CAE) for the requested token. When true, azidentity credentials request CAE tokens for resource APIs supporting CAE. Clients are responsible for handling CAE challenges. If a client that doesn't handle CAE challenges receives a CAE token, it may end up in a loop retrying an API call with a token that has been revoked due to CAE. The default is false.
- `subscription_id` (String) SubscriptionID is the ID (or name) of a subscription. Set this to acquire tokens for an account other than the Azure CLI's current account. The default is empty.
- `tenant_id` (String) TenantID sets the default tenant for authentication via the Azure CLI and workload identity. The default is empty, use 'organizations' or 'common' if you can't provide one but required to use one.
- `timeout` (String) Timeout sets the maximum time allowed for the request to complete, the string is a possibly signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as '300ms', '1.5h' or '2h45m'. Valid time units are 'ns', 'us' (or 'Âµs'), 'ms', 's', 'm', 'h'. The default is 30 seconds ('30s').

### Read-Only

- `access_token` (String, Sensitive) The issued access token.
- `error` (String) Error message if acquiring a token failed.
- `expires_on` (String) When the issued access token expires in RFC3339 format.
- `success` (Boolean) Indicates if a token was successfully acquired.